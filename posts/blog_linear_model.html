<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="ASA Covariate Adjustment Working Group Education Subteam">
<meta name="dcterms.date" content="2024-09-24">

<title>Covariate Adjustment for Linear Models: Understanding FDA Advice on Standard Errors – ASA-BIOP Covariate Adjustment SWG</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c75bcb89907db7808f0349b764a1a524.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ASA-BIOP Covariate Adjustment SWG</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about-us" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">About Us</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-about-us">    
        <li>
    <a class="dropdown-item" href="../about.html">
 <span class="dropdown-text">About</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../people.html">
 <span class="dropdown-text">People</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-task-force" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Task Force</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-task-force">    
        <li>
    <a class="dropdown-item" href="../subteam_advancement.html">
 <span class="dropdown-text">Advancement Subteam</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../subteam_software.html">
 <span class="dropdown-text">Software Subteam</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../subteam_standardization.html">
 <span class="dropdown-text">Standardization and Outreach Subteam</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../subteam_education.html">
 <span class="dropdown-text">Education Subteam</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../news.html"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-event" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Event</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-event">    
        <li>
    <a class="dropdown-item" href="../journal_club.html">
 <span class="dropdown-text">Journal Club</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../conference.html">
 <span class="dropdown-text">Conference Presentation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://www.linkedin.com/in/asa-biopharmaceutical-section-working-group-of-covariate-adjustment-2050b62b8/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://twitter.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter-x"></i></a>
    <a href="https://github.com/carswg/carswg.github.io" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="../index.xml" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-rss"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#prior-reading" id="toc-prior-reading" class="nav-link active" data-scroll-target="#prior-reading">Prior reading</a></li>
  <li><a href="#goal-for-this-blogpost" id="toc-goal-for-this-blogpost" class="nav-link" data-scroll-target="#goal-for-this-blogpost">Goal for this blogpost</a></li>
  <li><a href="#assumptions-about-sampling-framework-and-estimands" id="toc-assumptions-about-sampling-framework-and-estimands" class="nav-link" data-scroll-target="#assumptions-about-sampling-framework-and-estimands">Assumptions about sampling framework and estimands</a></li>
  <li><a href="#understanding-variance-estimation-recommendations-in-the-2x2-table." id="toc-understanding-variance-estimation-recommendations-in-the-2x2-table." class="nav-link" data-scroll-target="#understanding-variance-estimation-recommendations-in-the-2x2-table.">Understanding variance estimation recommendations in the 2x2 table.</a>
  <ul class="collapse">
  <li><a href="#treatment-by-covariate-interactions" id="toc-treatment-by-covariate-interactions" class="nav-link" data-scroll-target="#treatment-by-covariate-interactions">Treatment by covariate interactions</a>
  <ul class="collapse">
  <li><a href="#law-of-total-variance" id="toc-law-of-total-variance" class="nav-link" data-scroll-target="#law-of-total-variance">Law of total variance</a></li>
  <li><a href="#illustrative-example" id="toc-illustrative-example" class="nav-link" data-scroll-target="#illustrative-example">Illustrative example</a></li>
  </ul></li>
  <li><a href="#homogeneous-working-model" id="toc-homogeneous-working-model" class="nav-link" data-scroll-target="#homogeneous-working-model">Homogeneous working model</a>
  <ul class="collapse">
  <li><a href="#back-to-an-unadjusted-analysis" id="toc-back-to-an-unadjusted-analysis" class="nav-link" data-scroll-target="#back-to-an-unadjusted-analysis">Back to an unadjusted analysis</a></li>
  <li><a href="#what-about-the-sandwich-estimator" id="toc-what-about-the-sandwich-estimator" class="nav-link" data-scroll-target="#what-about-the-sandwich-estimator">What about the sandwich estimator?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#summary-and-comment-on-misspecified-mean-models" id="toc-summary-and-comment-on-misspecified-mean-models" class="nav-link" data-scroll-target="#summary-and-comment-on-misspecified-mean-models">Summary and comment on misspecified mean models</a></li>
  <li><a href="#p.s.-more-alternative-estimands" id="toc-p.s.-more-alternative-estimands" class="nav-link" data-scroll-target="#p.s.-more-alternative-estimands">P.s. more alternative estimands</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Covariate Adjustment for Linear Models: Understanding FDA Advice on Standard Errors</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>ASA Covariate Adjustment Working Group Education Subteam </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 24, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Please see the website https://carswg.github.io/ for information about the ASA Covariate Adjustment Working Group.</p>
<section id="prior-reading" class="level1">
<h1>Prior reading</h1>
<p>The blogpost <a href="https://stats4datascience.com/posts/covariate_adjustment/">How to get the most out of prognostic baseline variables in clinical trial</a> by Courtney Schiffman, Michel Friesenhahn, and Christina Rabe is an excellent starting point for learning about modern methods of covariate adjustment and their practical implementation. The post focuses on linear models and covers most important aspects.</p>
<p>One area that might benefit from further explanation is variance estimation. The post suggests “using robust standard error estimators from the targeted maximum likelihood estimation (TMLE) literature”. Analytic formulas and R code are included in a straightforward way with references to the literature (Rosenblum and van der Laan, 2010). Nevertheless, it may be helpful to add some more intuitive explanation.</p>
</section>
<section id="goal-for-this-blogpost" class="level1">
<h1>Goal for this blogpost</h1>
<p>The <a href="https://www.fda.gov/regulatory-information/search-fda-guidance-documents/adjusting-covariates-randomized-clinical-trials-drugs-and-biological-products">FDA (2023) guidance document on covariate adjustment</a> contains the following paragraph in the section on linear models:</p>
<p><strong>Nominal standard errors are often the default method in most statistical software packages. Even if the model is incorrectly specified, they are acceptable in two arm trials with 1:1 randomization. However, in other settings, these standard errors can be inaccurate when the model is misspecified. Therefore, the Agency recommends that sponsors consider use of a robust standard error method such as the Huber-White “sandwich” standard error when the model does not include treatment by covariate interactions (Rosenblum and van der Laan 2009; Lin 2013). Other robust standard error methods proposed in the literature can also cover cases with interactions (Ye et al.&nbsp;2022). An appropriate nonparametric bootstrap procedure can also be used (Efron and Tibshirani 1993).</strong></p>
<p>There is a lot to unpick in this short paragraph. The situation can be summarized in the following two-by-two table of recommended variance estimation methods.</p>
<p><img src="./files_blog_linear_model/lm_two_by_two_ehw.PNG" class="img-fluid"></p>
<p>This is what we mean by these terms:</p>
<ul>
<li><em>Model-based</em> – a.k.a. “nominal” standard errors. What is produced by default in <code>lm</code>. Assumes a linear model with homoscedastic error terms.</li>
<li><em>Sandwich</em> – a.k.a. Eicker-Huber-White standard errors.</li>
<li><em>Influence function</em> – variance estimation methods that are based on an estimator’s <a href="https://urldefense.com/v3/__https://economics.mit.edu/sites/default/files/publications/inf21_mar_27.pdf__;!!N3hqHg43uw!o5yA_o8iLzExQQ9Oxy2liAf_MXKGLGOE1oaPCaRgj7boCu766uTjubaaP9dpELk7H-MPn8bZq4Yfli9RPnTyH7amvn61NktOpg$"><em>influence function</em></a> . See, for example, Tsiatis et al., (2008), Moore and van der Laan (2009), Rosenblum and van der Laan (2010), Ye et al.&nbsp;(2022).</li>
</ul>
<p>The goal of this blogpost is to give an intuitive understanding for why this two-by-two table looks the way it does.</p>
</section>
<section id="assumptions-about-sampling-framework-and-estimands" class="level1">
<h1>Assumptions about sampling framework and estimands</h1>
<p>The two-by-two table makes assumptions about the sampling framework and target estimand. Namely, it assumes the superpopulation sampling framework with potential outcomes. That is, <span class="math inline">\((Y_i(1), Y_i(0), A_i, X_i)\)</span> for <span class="math inline">\(i=1,\ldots,N\)</span> are i.i.d. random variables from joint distribution <span class="math inline">\(f\)</span> where treatment assignment <span class="math inline">\(A_i\)</span> is independent of the covariate and potential outcomes <span class="math inline">\(X_i, Y_i(0), Y_i(1)\)</span>. The target of inference is <span class="math inline">\(E_f(Y_i(1) - Y_i(0))\)</span>. Also we assume there is a sufficiently large sample size to rely on asymptotic results.</p>
<p>In this blogpost, we will restrict attention to simple random sampling. Many clinical trials employ permuted block randomization, which would contradict the assumption we have just made that <span class="math inline">\((Y_i(1), Y_i(0), A_i, X_i)\)</span> are i.i.d. While it’s possible to accommodate alternative randomization schemes (see e.g., Ye et al., 2022; Wang et al., 2023), we’ll stick to the simpler theory around simple random sampling. For justification, see the section on <a href="https://stats4datascience.com/posts/covariate_adjustment/#accounting-for-stratified-randomization">“Accounting for Stratified Randomization” by Schiffman, Friesenhahn and Rabe</a></p>
<p>One potential alternative estimand would be the Conditional Average Treatment Effect at one specific covariate value, CATE(<span class="math inline">\(x\)</span>), which is defined as <span class="math inline">\(E_f(Y_i(1) - Y_i(0) \mid X_i = x)\)</span>. A common approach to estimating CATE(<span class="math inline">\(x\)</span>) is to assume a model of the form <span class="math display">\[Y_i = \beta_0 + \beta_1A_i + \beta_2X_i + \epsilon_i,\]</span> in which case CATE(<span class="math inline">\(x\)</span>) is equal to <span class="math inline">\(\beta_1\)</span> for all <span class="math inline">\(x\)</span>. So the task reduces to estimating <span class="math inline">\(\beta_1\)</span>. The Population Average Treatment Effect, <span class="math inline">\(E_f(Y_i(1) - Y_i(0))\)</span>, is also equal to <span class="math inline">\(\beta_1\)</span> in this case.</p>
<p>If the assumed model is wrong, the interpretation of <span class="math inline">\(\hat{\beta}_1\)</span> (the usual least squares estimator) as a consistent estimator of <span class="math inline">\(E_f(Y_i(1) - Y_i(0) \mid X_i = x)\)</span> is wrong – there is no reason in general for CATE(<span class="math inline">\(x\)</span>) to be constant across different values of <span class="math inline">\(x\)</span>. On the other hand, the interpretation of <span class="math inline">\(\hat{\beta}_1\)</span> as a consistent estimator of <span class="math inline">\(E_f(Y_i(1) - Y_i(0))\)</span> remains correct (Van Lancker et al., 2024). This can be seen from the fact that <span class="math inline">\(\hat{\beta}_1 \approx \bar{Y}_1 - \bar{Y}_0 - \hat{\beta}_2(\bar{X}_1 - \bar{X}_0)\)</span> where <span class="math inline">\(\bar{Y}_j\)</span> and <span class="math inline">\(\bar{X}_j\)</span> are the sample means of <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>, respectively, on treatment <span class="math inline">\(j\)</span> (see Appendix of Tsiatis et al., 2008), and <span class="math inline">\(\bar{X}_1 - \bar{X}_0\)</span> being asymptotically zero.</p>
<p>Sometimes, we may assume an outcome model that includes treatment-covariate interactions, <span class="math display">\[Y_i = \beta_0 + \beta_1A_i + \beta_2X_i + \beta_3A_iX_i + \epsilon_i.\]</span> In this case, if the true underlying model really does contain treatment-covariate interactions, then the estimand CATE(<span class="math inline">\(x\)</span>) is not constant in <span class="math inline">\(x\)</span>, which makes it somewhat unsuitable as an estimand for primary analysis in an RCT. One could, however, with a few extra steps, use this model to estimate <span class="math inline">\(E_f(Y_i(1) - Y_i(0))\)</span>. One option is g-computation (or standardization), whereby we estimate <span class="math inline">\(E_f(Y_i(1))\)</span> by the average of the model based predictions when setting the treatment assignment to <span class="math inline">\(1\)</span>,</p>
<p><span class="math display">\[\hat{\mu}(1) = \frac{1}{N} \sum_{i = 1}^N \hat{\beta}_0 + \hat{\beta}_1 + \hat{\beta}_2X_i + \hat{\beta}_3X_i,\]</span> and we estimate <span class="math inline">\(E_f(Y_i(0))\)</span> similarly by setting the treatment assignment to <span class="math inline">\(0\)</span>, <span class="math display">\[\hat{\mu}(0) = \frac{1}{N} \sum_{i = 1}^N \hat{\beta}_0 + \hat{\beta}_2X_i.\]</span></p>
<p>A possible estimator of <span class="math inline">\(E_f(Y_i(1) - Y_i(0))\)</span> is therefore,</p>
<p><span class="math display">\[\hat{\mu}(1) - \hat{\mu}(0) = \hat{\beta}_1 + \bar{X}\hat{\beta}_3.\]</span></p>
<p>Including treatment-covariate interaction terms in the outcome model is somewhat discouraged in <a href="https://www.ema.europa.eu/en/documents/scientific-guideline/guideline-adjustment-baseline-covariates-clinical-trials_en.pdf">an EMA guidance document from 2015</a> with the following statement.</p>
<p><strong><em>If there is no reason to suspect an interaction between treatment and a covariate then the primary analysis should only include the main effects for treatment and covariate. Conversely, if a substantial treatment by covariate interaction is suspected at the design stage, then stratified randomisation and/or subgroup analyses should be pre-planned accordingly.</em></strong></p>
<p>The blogpost <a href="https://stats4datascience.com/posts/covariate_adjustment/">How to get the most out of prognostic baseline variables in clinical trial</a> also recommends not to include such terms, but for a different reason. The experience of the authors is that adding such terms to a model does not typically lead to a meaningful increase in efficiency, and we need to be mindful of our “model budget”, that is, the allowable number of terms in a working model relative to the sample size before performance degrades.</p>
<p>For a linear model with 1:1 randomization, under the sampling framework outlined above, there is no efficiency gain to be had from modelling treatment-covariate interactions even when these interactions are extremely large (Tsiatis, 2008). This possibly surprising fact deserves a separate blogpost.</p>
<p>Nevertheless, the FDA guidance document is open to including such treatment-covariate interaction terms:</p>
<p><strong><em>The linear model may include treatment by covariate interaction terms. However, when using this approach, the primary analysis can still be based on an estimate from the model of the average treatment effect (Tsiatis et al.&nbsp;2008; Ye et al.&nbsp;2021).</em></strong></p>
</section>
<section id="understanding-variance-estimation-recommendations-in-the-2x2-table." class="level1">
<h1>Understanding variance estimation recommendations in the 2x2 table.</h1>
<section id="treatment-by-covariate-interactions" class="level2">
<h2 class="anchored" data-anchor-id="treatment-by-covariate-interactions">Treatment by covariate interactions</h2>
<p>To understand the right hand column of the two-by-two table, where neither the model-based nor the sandwich estimator would be recommended, we can stay within the framework of a correctly specified working model, <span class="math display">\[Y_i = \beta_0 + \beta_1A_i + \beta_2X_i + \beta_3A_iX_i + \epsilon_i,\]</span></p>
<p>where <span class="math inline">\(\epsilon_i \sim N(0, \sigma^2)\)</span>. At the moment, we are assuming that this model is correctly specified in the sense of having the correct <em>mean model</em> <span class="math inline">\(E(Y_i\mid A_i, X_i) = \beta_0 + \beta_1A_i + \beta_2X_i + \beta_3A_iX_i\)</span>, in the sense of having the correct <em>variance model</em> <span class="math inline">\(\mathrm{var}(Y_i\mid A_i, X_i) = \sigma^2\)</span>, and also in the sense of having the correct distribution. These assumptions will be relaxed later in the post.</p>
<p>The first important point is that the parameter <span class="math inline">\(\beta_1\)</span> does not in general correspond to <span class="math inline">\(E_f(Y_i(1) - Y_i(0))\)</span>, so we cannot simply report the maximum likelihood estimate <span class="math inline">\(\hat{\beta}_1\)</span>. To use the working model to estimate <span class="math inline">\(E_f(Y_i(1) - Y_i(0))\)</span>, one option is g-computation (or standardization). As described above, this produces an estimator <span class="math inline">\(\hat{\beta}_1 + \bar{X}\hat{\beta}_3\)</span>.</p>
<p>The question remains how do we estimate <span class="math inline">\(\mathrm{var}(\hat{\beta}_1 + \bar{X}\hat{\beta}_3)\)</span>?</p>
<section id="law-of-total-variance" class="level3">
<h3 class="anchored" data-anchor-id="law-of-total-variance">Law of total variance</h3>
<p>The law of total variance (with a correctly specified mean model) says that</p>
<p><span class="math display">\[\begin{equation}
\begin{split}
\mathrm{var}(\hat{\beta}_1 + \bar{X}\hat{\beta}_3) &amp;=  E \left\lbrace \mathrm{var}(\hat{\beta}_1 + \bar{X}\hat{\beta}_3 \mid \underline{A}, \underline{X})\right\rbrace + \mathrm{var}\left\lbrace E(\hat{\beta}_1 + \bar{X}\hat{\beta}_3\mid \underline{A}, \underline{X}) \right\rbrace\\  &amp;=  
E \left\lbrace \mathrm{var}(\hat{\beta}_1 + \bar{X}\hat{\beta}_3 \mid \underline{A}, \underline{X})\right\rbrace + \beta_3^2\mathrm{var}(\bar{X})
\end{split}
\end{equation}\]</span></p>
<p>Given our assumptions about the correctness of the working model, the first term, <span class="math inline">\(E\left\lbrace \mathrm{var}(\hat{\beta}_1 + \bar{X}\hat{\beta}_3 \mid \underline{A}, \underline{X})\right\rbrace\)</span>, can be consistently estimated via</p>
<p><span class="math display">\[(0 ~~~1 ~~~0 ~~~\bar{x}) \widehat{\mathrm{var}}(\hat{\beta} \mid \underline{A}= \underline{a}, \underline{X}= \underline{x})  \left( \begin{array}{c} 0\\ 1 \\0 \\ \bar{x} \end{array} \right),\qquad\qquad(\mathrm{1})\]</span> where <span class="math inline">\(\widehat{\mathrm{var}}(\hat{\beta} \mid \underline{A}= \underline{a}, \underline{X}= \underline{x})\)</span> is either the standard model-based variance estimator for the maximum likelihood estimator of <span class="math inline">\(\beta\)</span> (as would typically be produced by default in standard software) in which case (1) represents the “model based” variance estimator in the two-by-two table above, or <span class="math inline">\(\widehat{\mathrm{var}}(\hat{\beta} \mid \underline{A}= \underline{a}, \underline{X}= \underline{x})\)</span> is a sandwich estimator, in which case (1) represents the “sandwich” variance estimator in the two-by-two table. In either case, (1) ignores the second term in the law of total variance, <span class="math inline">\(\beta_3^2\mathrm{var}(\bar{X})\)</span>. This is the reason why it is not recommended. Alternative variance estimators based on influence functions, e.g., Tstiatis et al.&nbsp;(2008), Rosenblum and van der Laan (2010), Ye et al.&nbsp;(2022), do take account of this second term.</p>
<p>We did not need to talk about misspecified working models in order to demonstrate why the “model-based” and “sandwich” variance estimators are not recommended when the working model contains treatment by covariate interactions. But it is worth saying at this point that the influence function methods remain asymptotically valid when the mean and/or variance model is misspecified.</p>
</section>
<section id="illustrative-example" class="level3">
<h3 class="anchored" data-anchor-id="illustrative-example">Illustrative example</h3>
<p>As a demonstration, we would need to simulate multiple (1000, say) trials from the working model above where there is a strong treatment by covariate interaction. For each simulated trial, we would record the estimate of the treatment effect, as well as the estimated variance of the treatment effect estimator according to the three different methods.</p>
<p>We’ll use the influence function approach as implemented in Ye et al.&nbsp;(2022) using the R package <a href="https://cran.r-project.org/web/packages/RobinCar/index.html">{robincar}</a>, noting this is the same as previous versions (e.g., Tstiatis et al.&nbsp;(2008), Rosenblum and van der Laan (2010)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RobinCar)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>sim_one_trial <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> a <span class="sc">+</span> x <span class="sc">+</span> a <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y=</span>y,<span class="at">a=</span><span class="fu">factor</span>(a),<span class="at">x=</span>x)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> a <span class="sc">*</span> x, <span class="at">data =</span> dat)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  estimate <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fu">mean</span>(x))) <span class="sc">%*%</span> fit<span class="sc">$</span>coefficients)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  model_based <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fu">mean</span>(x))) <span class="sc">%*%</span> <span class="fu">vcov</span>(fit) <span class="sc">%*%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fu">mean</span>(x))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  sandwich <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fu">mean</span>(x))) <span class="sc">%*%</span> sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(fit) <span class="sc">%*%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fu">mean</span>(x))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  ye <span class="ot">&lt;-</span> RobinCar<span class="sc">::</span><span class="fu">robincar_linear</span>(dat, </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"a"</span>, </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"y"</span>, </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">covariate_cols =</span> <span class="st">"x"</span>, </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">adj_method =</span> <span class="st">"ANHECOVA"</span>, </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">contrast_h =</span> <span class="st">"diff"</span>)<span class="sc">$</span>contrast<span class="sc">$</span>varcov[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">model_based =</span> model_based, </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">sandwich =</span> sandwich, </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">ye =</span> ye)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(<span class="fu">rep</span>(<span class="dv">200</span>, <span class="fl">1e3</span>), sim_one_trial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Empirically, the variance of the point estimates is…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(results<span class="sc">$</span>estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02753465</code></pre>
</div>
</div>
<p>We can see that the Ye et al.(2022) method is reasonably consistent with this…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results<span class="sc">$</span>ye)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02499644</code></pre>
</div>
</div>
<p>…while this is not the case for the other two methods…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results<span class="sc">$</span>model_based)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02020404</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results<span class="sc">$</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02064523</code></pre>
</div>
</div>
</section>
</section>
<section id="homogeneous-working-model" class="level2">
<h2 class="anchored" data-anchor-id="homogeneous-working-model">Homogeneous working model</h2>
<p>We can now move on to the first column of the two-by-two table. In this case, suppose the working model is <span class="math display">\[Y_i = \beta_0 + \beta_1A_i + \beta_2X_i + \epsilon_i\]</span> with <span class="math inline">\(N(0, \sigma^2)\)</span>.</p>
<p>If the mean model is correctly specified then it is clear that <span class="math inline">\(\beta_1 = E_f(Y_i(1) - Y_i(0))\)</span>. [Although it can also be shown via a lot of algebra (see e.g.&nbsp;the Appendix of Tsiatis et al.&nbsp;(2008)) that the maximum likelihood estimator <span class="math inline">\(\hat{\beta}_1\)</span> is consistent for <span class="math inline">\(E_f(Y_i(1) - Y_i(0))\)</span> even when the model is completely misspecified].</p>
<p>The question now is how to estimate <span class="math inline">\(\mathrm{var}(\hat{\beta}_1)\)</span>?</p>
<p>In contrast to the treatment-covariate interaction case, the law of total variance (with an assumption of a correctly specified mean model) now tells us that we can focus on estimating the conditional variance, <span class="math display">\[
\begin{equation}
\begin{split}
\mathrm{var}(\hat{\beta}_1) &amp;=  E \left\lbrace \mathrm{var}(\hat{\beta}_1  \mid \underline{A}, \underline{X})\right\rbrace + \mathrm{var}\left\lbrace E(\hat{\beta}_1\mid \underline{A}, \underline{X}) \right\rbrace\\  &amp;=  
E \left\lbrace \mathrm{var}(\hat{\beta}_1  \mid \underline{A}, \underline{X})\right\rbrace + 0.
\end{split}
\end{equation}
\]</span></p>
<p>There are two options: 1) a completely model-based approach, <span class="math inline">\(\widehat{\mathrm{var}}_M(\hat{\beta}_1 \mid \underline{A}= \underline{a}, \underline{X}= \underline{x})\)</span>, as would typically be produced by default in standard software. Or, 2) the well known Huber-White (White, 1980) “sandwich” estimator, <span class="math inline">\(\widehat{\mathrm{var}}_S(\hat{\beta}_1 \mid \underline{A}= \underline{a}, \underline{X}= \underline{x})\)</span>.</p>
<p>If all the working model assumptions are satisfied, then both (1) and (2) are consistent estimators of <span class="math inline">\(\mathrm{var}(\hat{\beta}_1)\)</span>. We could put a provisional tick mark next to all methods in the left-hand column of the two-by-two table. To replace some of those ticks with crosses, we can consider what happens when the variance model in the working model is not correctly specified.</p>
<section id="back-to-an-unadjusted-analysis" class="level3">
<h3 class="anchored" data-anchor-id="back-to-an-unadjusted-analysis">Back to an unadjusted analysis</h3>
<p>Actually, we can make things even simpler for ourselves by considering an unadjusted analysis with working model <span class="math display">\[Y_i = \beta_0 + \beta_1A_i + \epsilon_i, \qquad \epsilon_i \sim N(0, \sigma^2)\]</span> but where the true model is <span class="math display">\[Y_i = \beta_0 + \beta_1A_i + \epsilon_i, \qquad \epsilon_i \sim \begin{array}{c} N(0, \sigma_0^2), ~~A_i = 0 \\N(0, \sigma_1^2), ~~A_i = 1 \end{array}.\]</span> When using the misspecified working model, the maximum likelihood estimator for <span class="math inline">\(\mathrm{var}(\hat{\beta}_1 \mid \underline{A} = \underline{a})\)</span> is</p>
<p><span class="math display">\[v^{\mathrm{miss}} =\frac{\hat{\sigma}^2}{n_0} + \frac{\hat{\sigma}^2}{n_1}.\]</span></p>
<p>Substituting in</p>
<p><span class="math display">\[ \hat{\sigma}^2 = \frac{n_0\hat{\sigma}_0^2 + n_1\hat{\sigma}_1^2}{n_0 + n_1}\]</span> and rearranging yields</p>
<p><span class="math display">\[v^{\mathrm{miss}} = \frac{\hat{\sigma}_0^2}{n_1} + \frac{\hat{\sigma}_1^2}{n_0},\]</span> whereas when using the correct true model, the MLE based variance estimator is <span class="math display">\[v^{\mathrm{true}} =\frac{\hat{\sigma}_0^2}{n_0} + \frac{\hat{\sigma}_1^2}{n_1}.\]</span> Obviously the two are equivalent under equal allocation, but this is not the case for unequal allocation. We can plot what happens to <span class="math inline">\(v^{\mathrm{miss}}  / v^{\mathrm{true}}\)</span> as a function of <span class="math inline">\(\sigma_0 / \sigma_1\)</span> for various choices of allocation ratio (Treatment 1: Treatment 0), e.g, 2:1, 1:1 and 1:2 randomization…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sigma_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>sigma_0 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.33</span>, <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>v_ratio <span class="ot">&lt;-</span> <span class="cf">function</span>(n_0){(sigma_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1<span class="sc">+</span>sigma_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0)<span class="sc">/</span>(sigma_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1<span class="sc">+</span>sigma_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0)}</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sigma_0, <span class="fu">v_ratio</span>(<span class="at">n_0 =</span> <span class="dv">50</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"sigma_0 / sigma_1"</span>, <span class="at">ylab =</span> <span class="st">"ratio of variance estimates"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(sigma_0, <span class="fu">v_ratio</span>(<span class="at">n_0 =</span> <span class="dv">100</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="dv">2</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(sigma_0, <span class="fu">v_ratio</span>(<span class="at">n_0 =</span> <span class="dv">200</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">1</span>,<span class="fl">1.6</span>,<span class="fu">c</span>(<span class="st">"2:1"</span>, <span class="st">"1:1"</span>, <span class="st">"1:2"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_linear_model_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This shows, for example, that if the true variance on treatment 0 is larger than the true variance on treatment 1, and there are more patients on treatment 1, then the estimated model-based variance of <span class="math inline">\(\hat{\beta}_1\)</span> based on the misspecified working model will underestimate the true variance of <span class="math inline">\(\hat{\beta}_1\)</span>.</p>
<p>This is the reason why we need to put a cross next to the model-based approach for non-1:1 randomization when using a homogeneous working model. But we can keep a provisional tick when using 1:1 randomization.</p>
</section>
<section id="what-about-the-sandwich-estimator" class="level3">
<h3 class="anchored" data-anchor-id="what-about-the-sandwich-estimator">What about the sandwich estimator?</h3>
<p>For an unadjusted analysis, the sandwich estimator for <span class="math inline">\(\mathrm{var}(\hat{\beta}_1)\)</span> based on the misspecified working model is essentially equivalent to <span class="math inline">\(v^{\mathrm{true}}\)</span> above. So for this particular example, the sandwich estimator would still work fine. We can keep a provisional tick mark next to the sandwich estimator for both 1:1 and non-1:1 randomization.</p>
</section>
</section>
</section>
<section id="summary-and-comment-on-misspecified-mean-models" class="level1">
<h1>Summary and comment on misspecified mean models</h1>
<p>In this blogpost, we have attempted to show why the two-by-two table of recommended variance estimators looks the way it does.</p>
<p>We have been able to demonstrate clearly the reasons for all of the crosses in the two-by-two table. The ticks, however, are still provisional. We have only considered correctly-specifed models and one specific example where the only source of misspecification is an equal variance assumption.</p>
<p>It turns out that the tick marks can stay even when the working mean model is misspecified (subject to some regularity conditions). Proving this level of robustness has been the subject of much impressive work (see the reference list below and <a href="https://thestatsgeek.com/2019/04/29/ancova-in-rcts-model-based-standard-errors-are-valid-even-under-misspecification/">a nice summary here</a>) and is beyond the scope of this blogpost.</p>
</section>
<section id="p.s.-more-alternative-estimands" class="level1">
<h1>P.s. more alternative estimands</h1>
<p>The above discussion takes for granted that the estimand is the unconditional expectation of the difference in sample means</p>
<p><span class="math inline">\(E_f(Y_i(1) - Y_i(0)) = E_{f^N}(\bar{Y}_1 - \bar{Y}_0)\)</span>,</p>
<p>where <span class="math inline">\(f^N\)</span> is the joint distribution of all <span class="math inline">\(N\)</span> individuals’ data.</p>
<p>Another potential alternative estimand is the conditional expectation for the difference in sample means given the vector of baseline covariates,</p>
<p><span class="math inline">\(\frac{1}{N}\sum_{i=1}^NE_f(Y_i(1) - Y_i(0) \mid X_i = x_i) = E_{f^N}(\bar{Y}_1 - \bar{Y}_0 \mid \underline{X} = \underline{x})\)</span>.</p>
<p>This alternative estimand is discussed in the context of binary outcomes by <a href="https://doi.org/10.17605/OSF.IO/9MP58">Magirr et al.&nbsp;(2024)</a>. In this case, the recommendations for variance estimation would need to be changed, to reflect that the vector of baseline covariates is considered fixed.</p>
<p>Yet another alternative estimand is the sample average treatment effect,</p>
<p><span class="math display">\[\frac{1}{N}\sum_{i=1}^N Y_i(1) - Y_i(0),\]</span></p>
<p>where <em>randomization inference</em> methods could be applied (Guo and Basse, 2023).</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>Efron, B and RJ Tibshirani, 1993, An Introduction to the Bootstrap, Boca Raton (FL): Chapman &amp; Hall.</p>
<p>Rosenblum, M and MJ van der Laan, 2009, Using Regression Models to Analyze Randomized Trials: Asymptotically Valid Hypothesis Tests Despite Incorrectly Specified Models, Biometrics, 65(3):937-945.</p>
<p>Lin W, 2013, Agnostic Notes on Regression Adjustments to Experimental Data: Reexamining Freedman’s Critique, Annals of Applied Statistics, 7(1):295-318.</p>
<p>Ye, T, J Shao, Y Yi, and Q Zhao, 2022, Toward better practice Of Covariate Adjustment In Analyzing Randomized Clinical Trials, Journal of the American Statistical Association, doi: 10.1080/01621459.2022.2049278.</p>
<p>Tsiatis, Anastasios A., et al.&nbsp;“Covariate adjustment for two-sample treatment comparisons in randomized clinical trials: a principled yet flexible approach.” Statistics in medicine 27.23 (2008): 4658-4677.</p>
<p>White, Halbert. “A heteroskedasticity-consistent covariance matrix estimator and a direct test for heteroskedasticity.” Econometrica: journal of the Econometric Society (1980): 817-838.</p>
<p>Van Lancker, Kelly, Frank Bretz, and Oliver Dukes. “Covariate adjustment in randomized controlled trials: General concepts and practical considerations.” Clinical Trials (2024): 17407745241251568.</p>
<p>Guo, Kevin, and Guillaume Basse. “The generalized oaxaca-blinder estimator.” Journal of the American Statistical Association 118.541 (2023): 524-536.</p>
<p>Wang, B., Susukida, R., Mojtabai, R., Amin-Esmaeili, M., &amp; Rosenblum, M. (2023). Model-robust inference for clinical trials that improve precision by stratified randomization and covariate adjustment. Journal of the American Statistical Association, 118(542), 1152-1163</p>
<script src="https://giscus.app/client.js" data-repo="carswg/carswg.github.io" data-repo-id="R_kgDOLX8xOg" data-category="General" data-category-id="DIC_kwDOLX8xOs4CeZQB" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light_high_contrast" data-lang="en" crossorigin="anonymous" async="">
</script>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/carswg\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>